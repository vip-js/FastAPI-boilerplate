# FastAPI-boilerplate

A highly automated framework based on **FastAPI** and **SQLAlchemy 2.x**, designed to let developers focus only on business logic. The framework automatically handles other parts, integrating performance optimizations and security mechanisms. The code is elegant and concise, adhering to principles of high cohesion, low coupling, and easy extensibility.

## Project Overview

This project provides a highly automated backend framework where developers only need to focus on implementing business logic. Other parts, like routing, services, and repositories, are auto-generated by the framework. The framework has built-in performance optimization and security mechanisms, making it suitable for building high-performance, highly available web applications.

## Features

- **Automated Code Generation**: Automatically generates repository, service, and route code based on models and data schemas.
- **Dependency Injection**: Uses `dependency-injector` to automatically manage dependencies.
- **Security**: Built-in data validation, password encryption, authentication and authorization, SQL injection prevention, security headers, and more.
- **High Performance**: Uses asynchronous programming, connection pool optimization, caching, database indexing, and supports horizontal scaling.
- **Attack Prevention**: Enhanced defense with rate limiting, brute force prevention, and input validation.
- **Logging**: Standardized logging, request-response logging, exception logging, log rotation, and aggregation to facilitate troubleshooting.
- **Extensibility**: Designed for high cohesion and low coupling, making it easy to maintain and extend.

## Tech Stack

- **Backend Framework**: FastAPI
- **Database**: PostgreSQL
- **ORM**: SQLAlchemy 2.x
- **Asynchronous Programming**: asyncio
- **Dependency Injection**: dependency-injector
- **Cache Extension**: Redis
- **Message Queue**: Supports integrations like RabbitMQ, Kafka
- **Template Engine**: Jinja2

## Project Structure

```
FastAPI-boilerplate/
├── app/
│   ├── __init__.py                   # Marks the app directory as a package
│   ├── main.py                       # Application entry point
│   ├── config.py                     # Configuration file
│   ├── database.py                   # Database connection
│   ├── containers.py                 # Dependency injection container
│   ├── core/                         # Core modules
│   │   ├── __init__.py
│   │   ├── base.py                   # Base model and service
│   │   ├── generator.py              # Automatic code generator
│   │   ├── loader.py                 # Module auto-loader
│   │   ├── plugin_loader.py          # Plugin loader
│   │   └── registry.py               # Registry
│   ├── models/                       # Database models
│   │   ├── __init__.py
│   │   └── user.py
│   ├── schemas/                      # Pydantic data schemas
│   │   ├── __init__.py
│   │   └── user.py
│   ├── repositories/                 # Repository layer
│   │   ├── __init__.py
│   │   ├── base.py                   # Base repository class
│   │   └── __generated__/            # Auto-generated repository code
│   │       ├── __init__.py
│   │       └── user_repository.py
│   ├── services/                     # Service layer
│   │   ├── __init__.py
│   │   ├── base.py                   # Base service class
│   │   └── __generated__/            # Auto-generated service code
│   │       ├── __init__.py
│   │       └── user_service.py
│   ├── api/                          # API routes
│   │   ├── __init__.py
│   │   ├── base.py                   # Base route class
│   │   └── __generated__/            # Auto-generated route code
│   │       ├── __init__.py
│   │       └── user_route.py
│   ├── utils/                        # Utility modules
│   │   ├── __init__.py
│   │   ├── security.py               # Security related (e.g., password hashing)
│   │   └── query_helpers.py          # Query helper tools
│   ├── middleware/                   # Middleware
│   │   ├── __init__.py
│   │   ├── security_middleware.py    # Security middleware
│   │   └── logging_middleware.py     # Logging middleware
│   ├── templates/                    # Code generation templates
│   │   ├── repository.py.j2
│   │   ├── service.py.j2
│   │   └── route.py.j2
│   ├── plugins/                      # Plugins directory
│   │   └── __init__.py
│   └── requirements.txt              # Project dependencies
├── init_db.py                        # Database initialization script
└── .env                              # Environment variable configuration
```

## Environment Requirements

- Python 3.8 or higher
- PostgreSQL database
- Optional Redis for caching and rate limiting
- Operating systems: Windows, macOS, Linux

## Installation and Setup

### Clone the Repository

```
bash
git clone https://github.com/vip-js/FastAPI-boilerplate.git
cd FastAPI-boilerplate
```

### Create a Virtual Environment

```
bash

python3 -m venv venv
source venv/bin/activate  # 对于Linux/Mac
venv\Scripts\activate     # 对于Windows
```

### Install Dependencies

```
bash

pip install -r requirements.txt
```

### Configure Environment Variables

Based on `app/config.py`, you can set the following configurations via environment variables or in a `.env` file:

- `POSTGRES_USER`
- `POSTGRES_PASSWORD`
- `POSTGRES_HOST`
- `POSTGRES_PORT`
- `POSTGRES_DB`
- `SECRET_KEY`
- `REDIS_HOST`
- `REDIS_PORT`

Sample `.env` file:

```
POSTGRES_USER=postgres
POSTGRES_PASSWORD=yourpassword
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=yourdatabase
SECRET_KEY=your_secret_key
REDIS_HOST=localhost
REDIS_PORT=6379
```

### Initialize Database

Run the database initialization script:

```
bash

python init_db.py
```

### Start the Application

```
bash

uvicorn app.main:app --reload
```

The app will run at `http://127.0.0.1:8000`。

## Usage Instructions

### Adding a New Model

1. **Create a Model**

   Create a new model file in the `app/models/` directory, e.g., `product.py`:

   ```
   python
   
   
   from sqlalchemy import Column, Integer, String, Float
   from app.core.base import Base, register_model
   
   @register_model
   class Product(Base):
       __tablename__ = 'products'
   
       id = Column(Integer, primary_key=True, index=True)
       name = Column(String(length=100), nullable=False)
       price = Column(Float, nullable=False)
   ```

2. **Create Schema**

   Create a corresponding schema file in `app/schemas/`, e.g., `product.py`:

   ```
   python
   
   from pydantic import BaseModel, Field
   from app.core.base import register_schema
   
   @register_schema
   class ProductBase(BaseModel):
       name: str = Field(..., min_length=1, max_length=100)
       price: float
   
   @register_schema
   class ProductCreate(ProductBase):
       pass
   
   @register_schema
   class ProductRead(ProductBase):
       id: int
   
       class Config:
           orm_mode = True
   ```

3. **Restart the Application**

   Restart the application, and the framework will automatically generate the repository, service, and route code.

### Writing Business Logic

- **Service Layer Logic**: To customize business logic, add or override methods in the generated service class.

**Routes**: Basic CRUD routes are auto-registered, but you can manually add new routes.

## Performance and Security

- **Asynchronous Programming**: Fully utilizes asynchronous programming to maximize FastAPI and SQLAlchemy's async capabilities.
- **Connection Pool Optimization**: Adjust database connection pool parameters to improve concurrency.
- **Caching Mechanism**: Integrate Redis for caching and rate limiting.
- **Security Features**: Built-in data validation, password hashing, JWT authentication, and access control.
- **Defense Mechanisms**: Enhanced security through rate limiting, SQL injection prevention, and XSS protection.

## Logging and Monitoring

- **Logging**: Uses Python's `logging` module for standardized request, response, and exception logging.
- **Log Rotation**: Supports log file rotation based on date or size for easier management.
- **Performance Monitoring**: Integrates Prometheus for monitoring application performance metrics.
- **Error Alerts**: Expandable error alert functionality via email, SMS notifications, etc.

## Frequently Asked Questions (FAQ)

1. **Database Connection Failure**
   - Check if the database configuration in `config.py` is correct.
   - Ensure the PostgreSQL service is running.
2. **Code Generation Issues**
   - Ensure that after adding a new model and schema, you restart the application to trigger the code generator.
3. **Dependency Compatibility Issues**
   - Ensure you are installing dependencies with the specified versions in `requirements.txt`.

## Contribution Guidelines

Contributions are welcome! Please submit issues and pull requests to improve this project. Before submitting, ensure the following guidelines are met:

- Maintain consistent code style and clear variable naming.
- Add necessary comments to explain code logic.
- Thoroughly test code before submission to ensure stability.

## License

MIT License.

------

Thank you for using this project! If you have any questions or suggestions, feel free to reach out.